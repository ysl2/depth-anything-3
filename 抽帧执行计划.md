# 抽帧脚本执行计划

## Context

上次的 DA3-Streaming 处理因为中间产物占满磁盘导致程序崩溃。为了避免再次发生，需要从视频中抽取部分帧（2 FPS）而非全部帧。

**当前状态：**
- 9 个 DJI Mini 3 Pro 视频（DJI_0522 ~ DJI_0530）
- 总时长约 43 分钟
- 全帧数据（30 fps）已存放在 `fps_all/`，约 71,691 帧
- 2 fps 抽帧预计约 5,200 帧，中间产物约 16GB

**目标：**
1. 从视频中抽取 2 FPS 的帧
2. 输出路径：`/home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA/fps_2/`
3. 目录结构参考 `fps_all/`：每个视频一个文件夹 + images 文件夹（相对软链接）

## Plan

### Step 1: 创建抽帧脚本

创建新脚本 `extract_frames_2fps.sh`，参考现有的 `extract_frames.sh`。

**关键差异：**
- 添加 `-filter:v fps=fps=2` 参数实现 2 fps 抽帧
- 输出路径改为 `/home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA/fps_2/`
- 帧命名格式与 `fps_all` 保持一致：`DJI_XXXX_000001.jpg`

**脚本路径：** `/home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA/extract_frames_2fps.sh`

### Step 2: 执行抽帧脚本

```bash
cd /home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA
chmod +x extract_frames_2fps.sh
./extract_frames_2fps.sh
```

### Step 3: 创建 images 文件夹和相对软链接

抽帧完成后，在 `fps_2/` 下创建 `images` 文件夹，并使用 `ln -srf` 创建相对软链接：

```bash
cd /home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA/fps_2
mkdir -p images
for dir in DJI_*/; do
    ln -srf "$dir"*.jpg images/
done
```

### Step 4: 验证结果

1. 检查帧数：每个视频约为 `原帧数 / 15`
2. 检查软链接：`ls -la images/ | head -10`
3. 检查总大小：`du -sh fps_2/`

## Critical Files

| 文件 | 说明 |
|------|------|
| `/home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA/extract_frames.sh` | 参考脚本（全帧提取） |
| `/home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA/extract_frames_2fps.sh` | 新建脚本（2fps 提取） |
| `/home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA/fps_all/` | 参考目录结构 |

## FFmpeg Parameters

| 参数 | 值 | 说明 |
|------|-----|------|
| `-filter:v fps=fps=2` | 2 fps | 每 15 帧抽 1 帧 (30/2=15) |
| `-q:v 1` | 1 | JPG 质量 98% |
| `-vsync 0` | 0 | 每帧都处理 |

## Expected Output

```
/home/songliyu/Templates/DJI-Mini3-Pro/20260204/102MEDIA/fps_2/
├── DJI_0522/
│   ├── DJI_0522_000001.jpg
│   └── ... (~646 帧)
├── DJI_0523/
│   └── ... (~646 帧)
├── ...
└── images/
    ├── DJI_0522_000001.jpg -> ../DJI_0522/DJI_0522_000001.jpg
    └── ... (所有帧的相对软链接)
```

## Verification

1. **帧数验证：**
   ```bash
   for dir in fps_2/DJI_*/; do echo -n "$(basename $dir): "; ls "$dir" | wc -l; done
   ```
   预期：每个视频约 646 帧 (9689 / 15 ≈ 646)

2. **软链接验证：**
   ```bash
   ls -la fps_2/images/ | head -5
   ```
   预期：显示相对软链接如 `../DJI_0522/DJI_0522_000001.jpg`

3. **可读性验证：**
   ```bash
   file fps_2/images/DJI_0522_000001.jpg
   ```
   预期：显示 JPEG image data

4. **存储空间：**
   ```bash
   df -h /home/songliyu/Templates
   df -h /media/songliyu/T7
   ```
